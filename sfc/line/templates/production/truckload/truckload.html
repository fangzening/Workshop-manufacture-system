{% include 'manufacturing/include/header.html' %}
{% include 'manufacturing/include/sidebar.html' %}
{% include 'manufacturing/include/error-modal-style.html' %}
{% load static %}
<script src="{% static 'js/truckload/jquery-3.5.1.min.js' %}"></script>
<script src="{% static 'js/truckload/truckload.js' %}"></script>
<link href="{% static 'css/truckload/bootstrap.min.css' %}" rel="stylesheet">
<section id="main-content">
    <section class="wrapper">
        <div class="row">
            <div class="col-lg-12">
                <ol class="breadcrumb">
                   <li><i class="fa fa-home"></i><a href="{% url 'manufacturing:home' %}">Dashboard</a></li>
                   <!--<li><i class="icon_genius"></i><a href="{% url 'manufacturing:sub_shipping_manager' %}">Shipping Management</a></li>-->
                   <li><i class="fa fa-square-o"></i>Truckload</li>
                </ol>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 scanner-content">
                <section class="panel">
                    <div class="panel-body" style="padding: 0;">

                        <div class="form-horizontal mobile-content"  id="" style="display: block;">
                             <div class="form-group section-border">

                                   <div class="col-sm-6 scanner-content" id="TruckLoad">
                                        <section class="panel">
                                             <div class="form-group section-border col-sm-12" >
                                              <div class="col-sm-12 scanner-content">
                                                    <h2 class="pallettization-title">TruckLoad</h2>
                                                   <a class="mobile-link"  href="#Pallet-Detail">go to Pallet Detail</a>
                                              </div>
                                             </div>
                                            <form class="form-horizontal" onSubmit="return false;">
                                            {% csrf_token %}
                                             <div class="col-sm-12 scanner-content">

                                                 <div class="scanner-content " style="">
                                                   <div class="scanner-content">
                                                        <label class="col-sm-12" style="padding-left: 0;"> Choose a pallet</label>
                                                           <div class="col-sm-8" style="padding: 0;">

                                                            <select class="form-control custom-select" id="dn_select_list">
                                                                <option selected>Choose...</option>
                                                                {% if dn_list %}
                                                                    {% for dn in dn_list %}
                                                                        <option value="{{ dn.deliverynumber_id }}">{{ dn.deliverynumber_id }}</option>
                                                                    {% endfor %}
                                                                {% else %}
                                                                {% endif %}
                                                            </select>
                                                           </div>
                                                            <div class="col-sm-4" id="dn-button-div">
                                                            <button id="dn-g-button" class="btn header-button btn-open" type="button" onclick="GetPalletDN()">&nbsp;<strong> + Delivery Number</strong></button>
                                                           </div>
                                                     </div>
                                                 </div>
                                             </div>

                                            <!-- scan result--> <!-- space  -->
                                              <div class=""  id="truckload-space">
                                                <label class=""  style="opacity: 0;">Pallet ID:</label>
                                                     <input  style="opacity: 0;" type="text" class="form-control">
                                            </div>

                                             <div class="col-sm-12 scanner-content">
                                                 <div class="col-sm-12">
                                                    <table class='col-sm-12' id="total_pallet_qty">
                                                        <thead><tr class="table-header"><th>Total Pallet Qty</th></tr></thead>
                                                        <tbody><tr><td>0</td></tr></tbody>
                                                    </table>
                                                </div>
                                                <div class="col-sm-12">
                                                    <table class='col-sm-12' id="scanned_pallet_qty">
                                                        <thead><tr class="table-header"><th>Scanned Pallet Qty</th></tr></thead>
                                                        <tbody><tbody><tr><td>0</td></tr></tbody></tbody>
                                                    </table>
                                                </div>
                                             </div>

                                              <div class="col-sm-12 scanner-content">
                                                    <div class="col-sm-12 panel-body-table-truckload-filter">
                                                        <table class='table table-sm' id="dn_information">
                                                            <thead>
                                                                <tr class="table-header">
                                                                    <th>Pallets Qty</th>
                                                                    <th>Customer PO</th>
                                                                    <th>Sales Order</th>
                                                                    <th>Qty</th>
                                                                    <th>Shipped Qty</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                              </div>
                                          </section>
                                         </div>


                                        <div class="col-sm-6 scanner-content" id="Pallet-Detail">
                                            <section class="panel">
                                                 <div class="form-group section-border col-sm-12">
                                                       <div class="col-sm-12 scanner-content">
                                                        <h2 class="pallettization-title">Pallet Detail</h2>
                                                        <a class="mobile-link"  href="#TruckLoad">go to TruckLoad</a>
                                                       </div>
                                                    </div>
                                            <!-- input -->
                                            <div class="">
                                                 <div class="section-border col-sm-12 scanner-content truckload-input">
                                                <div class="truckload-input-area">
                                                    <label class="">Pallet ID:</label>
                                                         <input type="text" class="form-control" name="pallet_id" id="pallet_id" required>
                                                </div>
                                                 <div class="col-sm-6 truckload-input-area" style="padding: 0;" id="container-no">
                                                    <label class="">Container Number:</label>
                                                    <div class="" >
                                                        <input type="text" class="form-control" name="container_number" id="container_number" required>
                                                    </div>
                                                 </div>
                                                 <div class="col-sm-6 truckload-input-area" style="padding: 0;" id="serial-no">
                                                     <label class="">Seal Number:</label>
                                                     <div class="">
                                                         <input type="text" class="form-control" name="seal_number" id="seal_number" required>
                                                     </div>
                                                 </div>
                                            </div>
                                            <!-- input -->
                                             <div class="col-sm-12 scanner-content">
                                                  <div class="col-sm-6 pallet-button-div-left">
                                                      <button id="truckload-button" class="btn btn-info" onclick="TruckLoad()">Truck Load</button>
                                                  </div>
                                                 <div class="col-sm-6 pallet-button-div-right">
                                                       <button id="truckload-print" class="btn btn-info">Print</button>
                                                 </div>

                                                <div class="col-sm-12 panel-body-table-truckload" id="truckload-validation-table">
                                                    <table class='table table-sm' id="pallet_validation">
                                                        <thead>
                                                            <tr class="table-header">
                                                                <th>Customer PO</th>
                                                                <th>Delivery No</th>
                                                                <th>Pallet Id</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                        </tbody>
                                                    </table>
                                                </div>
                                             </div>
                                        </div>
                                        </section>
                                        </div>
<!--                                        <div class="form-group col-sm-12 border-section scanner-content">-->
<!--                                            <div class="col-sm-6">-->
<!--                                                 -->
<!--                                            </div>-->
<!--                                        </div>-->
                                         <div id="errorSection"></div>
                                         {% if messages %}
                                               <div id="myModal" class="modal-log message-box-bottom" style="padding-top: 0;">
                                                 <div class="modal-content-{{ message.tags }}">
                                                    {% for error in messages %}
                                                      <span class="close" data-dismiss="modal" style="z-index: 100;">×</span>
                                                      <div class="warning-modal-body">
                                                        <p class="card-title"><strong>Error: </strong>{{ error }}</p>
                                                      </div>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                        <input type="hidden" name='username' value="{{user.username}}">
                                    </form>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </section>
</section>
{% include 'manufacturing/include/javascript-sidebar.html' %}
<script src="{% static 'js/line/warning-modal.js' %}"></script>
<link href="{% static 'css/mobile-version.css' %}" rel="stylesheet">
{% csrf_token %}
<script type="text/javascript">
$("#pallet_id").keydown(function(event ) {
    if (event.keyCode == 13) {
        event.preventDefault();
        const pallet = document.getElementById("pallet_id").value;
        console.log("antes de function" + pallet);
        main.ValidatePallet(pallet);
    }
});

$(document).ready(function(){
    $("select.custom-select").change(function(){
        var dn = $(this).children("option:selected").val();
        var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
        console.log(dn);
        main.ValidateDN(dn, csrftoken);
    });
});

function GetPalletDN() {
    const dn = $("#dn_select_list :selected").val();
    var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
    main.GetPalletDN(dn, csrftoken);

};

function TruckLoad() {
    console.log("button press");
    var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
    main.SaveTruckLoad(csrftoken);
};
</script>
